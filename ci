#!/bin/bash
# vi:syntax=gentoo-init-d:

source /sbin/functions.sh
set -e; trap "eend 997" ERR

ebegin "pulling/merging updates"
cg update
eend $?

ebegin "updating update index (cache)"
(git-update-index --refresh >/dev/null)
einfo "(updated)";
eend $?

ebegin "committing changes"
if [ -z "$*" ]; then
    cg commit -m "$0"

else 
    cg commit -m "$*"
fi
eend $?

ebegin "pushing commit to repo"
cg push
eend $?

